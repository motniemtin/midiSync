{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///www/wwwroot/pianosync.com/src/app/%28pianosync%29/test/AlphaTabViewer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useEffect, forwardRef, useImperativeHandle, useCallback } from \"react\";\nimport { AlphaTabApi, Settings, LayoutMode } from \"@coderline/alphatab\";\n\nimport { Box } from '@mui/material';\n\nexport interface AlphaTabViewerHandles {\n  playPause: () => void;\n  stop: () => void;\n  setPlaybackPosition: (tick: number) => void;\n  get a_api(): AlphaTabApi | null;\n}\n\ninterface AlphaTabViewerProps {\n  xmlPath: string;\n  layoutMode?: 'page' | 'horizontal';\n  onScoreLoaded?: (score: any, duration: number) => void;\n  onMidiLoaded?: (e: { endTime: number }) => void;\n  onPlayerPositionChanged?: (e: { currentTime: number, endTime: number }) => void;\n  onPlayerStateChanged?: (e: { state: number, isPlaying: boolean }) => void;\n  width?: string | number;\n  height?: string | number;\n  scaling?: number;\n}\n\nexport const AlphaTabViewer = forwardRef<AlphaTabViewerHandles, AlphaTabViewerProps>(({ xmlPath, onScoreLoaded, onMidiLoaded, onPlayerPositionChanged, onPlayerStateChanged, width = '100%', height = '100%', scaling = 0.5, layoutMode = 'horizontal' }: AlphaTabViewerProps, ref) => {\n  const elementRef = useRef<HTMLDivElement | null>(null);\n  const apiRef = useRef<AlphaTabApi | null>(null);\n  useEffect(() => {\n    if (!elementRef.current || !xmlPath) return;\n\n    const baseUrl = window.location.origin;\n    const settings: Settings = {\n      core: {\n        fontDirectory: `${baseUrl}/alphaTab/font/`,\n      },\n      player: {\n        enablePlayer: true,\n        enableCursor: true,\n        soundFont: `${baseUrl}/alphaTab/soundfont/sonivox.sf2`\n      },\n      display: {\n        layoutMode: layoutMode,\n        width: width,        // Chiều rộng của trang hiển thị\n        height: height,       // Chiều cao trang (nếu layoutMode là 'page')\n        scaling: scaling,       // Tỉ lệ phóng to (1.0 = 100%)        \n      },\n    };\n\n    const api = new AlphaTabApi(elementRef.current!, settings);\n    apiRef.current = api;\n\n    if (onScoreLoaded) {\n      apiRef.current.scoreLoaded.on((score) => {\n        onScoreLoaded(score, 0);\n      });\n      apiRef.current.playerReady.on(() => {\n        console.log('Thời lượng phát (giây):', api.player.duration);\n      });\n    }\n    if (onPlayerPositionChanged) {\n      apiRef.current.playerPositionChanged.on(onPlayerPositionChanged);\n    }\n    if (onMidiLoaded) {\n      apiRef.current.midiLoaded.on(onMidiLoaded);\n    }\n    if (onPlayerStateChanged) {\n      apiRef.current.playerStateChanged.on(onPlayerStateChanged);\n    }\n\n    // Sử dụng prop xmlPath để load file nhạc\n    apiRef.current.load(xmlPath);\n\n    return () => {\n      if (apiRef.current) {\n        apiRef.current?.destroy();\n      }\n    };\n  }, [xmlPath, onScoreLoaded, onPlayerPositionChanged, onPlayerStateChanged, onMidiLoaded, layoutMode, width, height, scaling]);\n\n  useImperativeHandle(ref, () => ({\n    playPause: () => {\n      apiRef.current?.playPause();\n    },\n    stop: () => {\n      apiRef.current?.stop();\n    },\n    setPlaybackPosition: (tick: number) => {\n      if (apiRef.current) apiRef.current.playbackRange = null;\n      if (apiRef.current) apiRef.current.tickPosition = tick;\n    },\n    get a_api() { return apiRef.current; }\n  }));\n  return (\n\n    <Box\n      sx={{\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundColor: 'lightblue'\n      }}\n    >\n      <div ref={elementRef} style={{ width: '100%', height: '100%' }} />\n    </Box >\n  );\n});\nAlphaTabViewer.displayName = 'AlphaTabViewer';"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAEA;AALA;;;;;AA0BO,MAAM,+BAAiB,IAAA,mNAAU,EAA6C,CAAC,EAAE,OAAO,EAAE,aAAa,EAAE,YAAY,EAAE,uBAAuB,EAAE,oBAAoB,EAAE,QAAQ,MAAM,EAAE,SAAS,MAAM,EAAE,UAAU,GAAG,EAAE,aAAa,YAAY,EAAuB,EAAE;IAC7Q,MAAM,aAAa,IAAA,+MAAM,EAAwB;IACjD,MAAM,SAAS,IAAA,+MAAM,EAAqB;IAC1C,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC,SAAS;QAErC,MAAM,UAAU,OAAO,QAAQ,CAAC,MAAM;QACtC,MAAM,WAAqB;YACzB,MAAM;gBACJ,eAAe,GAAG,QAAQ,eAAe,CAAC;YAC5C;YACA,QAAQ;gBACN,cAAc;gBACd,cAAc;gBACd,WAAW,GAAG,QAAQ,+BAA+B,CAAC;YACxD;YACA,SAAS;gBACP,YAAY;gBACZ,OAAO;gBACP,QAAQ;gBACR,SAAS;YACX;QACF;QAEA,MAAM,MAAM,IAAI,mLAAW,CAAC,WAAW,OAAO,EAAG;QACjD,OAAO,OAAO,GAAG;QAEjB,IAAI,eAAe;YACjB,OAAO,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;gBAC7B,cAAc,OAAO;YACvB;YACA,OAAO,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC;gBAC5B,QAAQ,GAAG,CAAC,2BAA2B,IAAI,MAAM,CAAC,QAAQ;YAC5D;QACF;QACA,IAAI,yBAAyB;YAC3B,OAAO,OAAO,CAAC,qBAAqB,CAAC,EAAE,CAAC;QAC1C;QACA,IAAI,cAAc;YAChB,OAAO,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC;QAC/B;QACA,IAAI,sBAAsB;YACxB,OAAO,OAAO,CAAC,kBAAkB,CAAC,EAAE,CAAC;QACvC;QAEA,yCAAyC;QACzC,OAAO,OAAO,CAAC,IAAI,CAAC;QAEpB,OAAO;YACL,IAAI,OAAO,OAAO,EAAE;gBAClB,OAAO,OAAO,EAAE;YAClB;QACF;IACF,GAAG;QAAC;QAAS;QAAe;QAAyB;QAAsB;QAAc;QAAY;QAAO;QAAQ;KAAQ;IAE5H,IAAA,4NAAmB,EAAC,KAAK,IAAM,CAAC;YAC9B,WAAW;gBACT,OAAO,OAAO,EAAE;YAClB;YACA,MAAM;gBACJ,OAAO,OAAO,EAAE;YAClB;YACA,qBAAqB,CAAC;gBACpB,IAAI,OAAO,OAAO,EAAE,OAAO,OAAO,CAAC,aAAa,GAAG;gBACnD,IAAI,OAAO,OAAO,EAAE,OAAO,OAAO,CAAC,YAAY,GAAG;YACpD;YACA,IAAI,SAAQ;gBAAE,OAAO,OAAO,OAAO;YAAE;QACvC,CAAC;IACD,qBAEE,8OAAC,wLAAG;QACF,IAAI;YACF,UAAU;YACV,KAAK;YACL,MAAM;YACN,OAAO;YACP,QAAQ;YACR,iBAAiB;QACnB;kBAEA,cAAA,8OAAC;YAAI,KAAK;YAAY,OAAO;gBAAE,OAAO;gBAAQ,QAAQ;YAAO;;;;;;;;;;;AAGnE;AACA,eAAe,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":["file:///www/wwwroot/pianosync.com/src/app/components/container/PageContainer.tsx"],"sourcesContent":["import { Helmet, HelmetProvider } from 'react-helmet-async';\r\n\r\ntype Props = {\r\n  seo: {\r\n    title: string;\r\n    description: string;\r\n    keywords: string;\r\n    thumb: string;\r\n  };\r\n  children: JSX.Element | JSX.Element[];\r\n};\r\n\r\nconst PageContainer = ({ seo, children }: Props) => {\r\n  return (\r\n    <HelmetProvider>\r\n      <div>\r\n        <Helmet>\r\n          <title>{seo.title}</title>\r\n          {/* Description & Keywords */}\r\n          <meta name=\"description\" content={seo.description} />\r\n          <meta name=\"keywords\" content={seo.keywords} />\r\n\r\n          {/* Open Graph */}\r\n          <meta property=\"og:title\" content={seo.title} />\r\n          <meta property=\"og:description\" content={seo.description} />\r\n          <meta property=\"og:image\" content={seo.thumb} />\r\n          <meta property=\"og:type\" content=\"website\" />\r\n\r\n          {/* Twitter Card */}\r\n          <meta name=\"twitter:card\" content=\"summary_large_image\" />\r\n          <meta name=\"twitter:title\" content={seo.title} />\r\n          <meta name=\"twitter:description\" content={seo.description} />\r\n        </Helmet>\r\n        {children}\r\n      </div>\r\n    </HelmetProvider>\r\n  );\r\n}\r\n\r\nexport default PageContainer;\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAYA,MAAM,gBAAgB,CAAC,EAAE,GAAG,EAAE,QAAQ,EAAS;IAC7C,qBACE,8OAAC,oLAAc;kBACb,cAAA,8OAAC;;8BACC,8OAAC,4KAAM;;sCACL,8OAAC;sCAAO,IAAI,KAAK;;;;;;sCAEjB,8OAAC;4BAAK,MAAK;4BAAc,SAAS,IAAI,WAAW;;;;;;sCACjD,8OAAC;4BAAK,MAAK;4BAAW,SAAS,IAAI,QAAQ;;;;;;sCAG3C,8OAAC;4BAAK,UAAS;4BAAW,SAAS,IAAI,KAAK;;;;;;sCAC5C,8OAAC;4BAAK,UAAS;4BAAiB,SAAS,IAAI,WAAW;;;;;;sCACxD,8OAAC;4BAAK,UAAS;4BAAW,SAAS,IAAI,KAAK;;;;;;sCAC5C,8OAAC;4BAAK,UAAS;4BAAU,SAAQ;;;;;;sCAGjC,8OAAC;4BAAK,MAAK;4BAAe,SAAQ;;;;;;sCAClC,8OAAC;4BAAK,MAAK;4BAAgB,SAAS,IAAI,KAAK;;;;;;sCAC7C,8OAAC;4BAAK,MAAK;4BAAsB,SAAS,IAAI,WAAW;;;;;;;;;;;;gBAE1D;;;;;;;;;;;;AAIT;uCAEe","debugId":null}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///www/wwwroot/pianosync.com/src/app/%28pianosync%29/test/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useTranslation } from 'react-i18next';\nimport { useState, useCallback, useRef } from 'react';\nimport { AlphaTabViewer, AlphaTabViewerHandles } from './AlphaTabViewer';\nimport PageContainer from '@/app/components/container/PageContainer';\nimport { Box, Slider, IconButton, Typography, Stack } from '@mui/material';\nimport { PlayArrow, Pause } from '@mui/icons-material';\n\n// Hàm định dạng thời gian từ giây sang MM:SS\nconst formatTime = (seconds: number) => {\n    const floorSeconds = Math.floor(seconds);\n    const min = Math.floor(floorSeconds / 60);\n    const sec = floorSeconds % 60;\n    return `${min}:${sec < 10 ? '0' : ''}${sec}`;\n};\n\nexport default function Test() {\n    const { t } = useTranslation();\n    const [score, setScore] = useState(null);\n    const [notesJson, setNotesJson] = useState(null);\n    const alphaTabRef = useRef<AlphaTabViewerHandles>(null);\n\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [currentTime, setCurrentTime] = useState(0);\n    const [duration, setDuration] = useState(0);\n\n\n    // Thay thế bằng đường dẫn thực tế đến file xml của bạn\n    const xmlPath = \"/windy_hill.musicxml\";\n\n    const handleScoreLoaded = useCallback((loadedScore: any, newDuration: number) => {\n        setScore(loadedScore);\n        try {            const _notesJson: any = {};\n            const track = loadedScore.tracks[0];\n            let _tempo = 120;\n            let _currentTime = 0;\n\n            track.staves.forEach((stave: any) => {\n                stave.bars.forEach((bar: any) => {\n                    if (loadedScore.masterBars[bar.index].tempoAutomation) {\n                        _tempo = loadedScore.masterBars[bar.index].tempoAutomation.value;\n                    }\n                    bar.voices.forEach((voice: any) => {\n                        voice.beats.forEach((beat: any) => {\n                            const _duration = ((beat.playbackDuration * (60000.0 / (_tempo * 960))) | 0) / 1000;\n                            beat.notes.forEach((note: any) => {\n                                if (typeof _notesJson[note.displayValue] === \"undefined\") {\n                                    _notesJson[note.displayValue] = [];\n                                }\n                                _notesJson[note.displayValue].push({ start: _currentTime, stop: _currentTime + _duration, fret: note.fret, string: note.string });\n                            });\n                            _currentTime += _duration;\n                        });\n                    });\n                });\n            });\n            setNotesJson(_notesJson);\n            console.log(\"Notes JSON created:\", _notesJson);\n        } catch (e) {\n            console.error(\"Error processing score:\", e);\n        }\n    }, []);\n\n    const handlePlayerPositionChanged = useCallback((e: { currentTime: number, endTime: number }) => {\n        setCurrentTime(e.currentTime);\n    }, []);\n\n    const handlePlayerStateChanged = useCallback((e: { state: number, isPlaying: boolean }) => {\n        setIsPlaying(e.isPlaying);\n    }, []);\n\n    const handleMidiLoaded = useCallback((e: { endTime: number }) => {\n        setDuration(e.endTime);\n    }, []);\n\n    const handlePlayPause = () => {\n        alphaTabRef.current?.playPause();\n    };\n\n    const handleSeek = (event: Event, newValue: number | number[]) => {\n        const newTime = newValue as number;\n        alphaTabRef.current?.a_api?.player.seek(newTime);\n    };\n\n    return (\n        <PageContainer\n            seo={{\n                title: \"TEST AlphaTab Viewer\",\n                description: \"Test page for AlphaTab Viewer integration\",\n                keywords: \"AlphaTab, MusicXML, Viewer, Test\",\n                thumb: \"/images/seo/dashboard-home.png\",\n            }}\n        >\n            <Box sx={{ width: '100%', position: 'relative', paddingTop: '56.25%', overflow: 'hidden'}}>\n                <AlphaTabViewer\n                    ref={alphaTabRef}\n                    xmlPath={xmlPath}\n                    onScoreLoaded={handleScoreLoaded}\n                    onPlayerPositionChanged={handlePlayerPositionChanged}\n                    onMidiLoaded={handleMidiLoaded}\n                    onPlayerStateChanged={handlePlayerStateChanged}\n                    width='100%'\n                    height='calc(100vh - 250px)'\n                    scaling={0.75}                    \n                    layoutMode='horizontal'\n                />\n            </Box>\n            <Box sx={{ p: 2, border: '1px solid #ccc', borderRadius: '4px', mt: 2 }}>\n                <Stack direction=\"row\" spacing={2} alignItems=\"center\">\n                    <IconButton onClick={handlePlayPause}>\n                        {isPlaying ? <Pause /> : <PlayArrow />}\n                    </IconButton>\n                    <Typography variant=\"body2\">\n                        {formatTime(currentTime)}\n                    </Typography>\n                    <Slider\n                        aria-label=\"time-indicator\"\n                        size=\"small\"\n                        value={currentTime}\n                        min={0}\n                        step={1}\n                        max={duration}\n                        onChange={handleSeek}\n                        sx={{\n                            height: 4,\n                        }}\n                    />\n                    <Typography variant=\"body2\">\n                        {formatTime(duration)}\n                    </Typography>\n                </Stack>\n            </Box>\n        </PageContainer>\n    );\n}"],"names":[],"mappings":"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","debugId":null}}]
}