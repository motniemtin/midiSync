{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///www/wwwroot/pianosync.com/src/app/test/AlphaTabViewer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRef, useEffect, forwardRef, useImperativeHandle, useCallback } from \"react\";\nimport { AlphaTabApi, Settings, LayoutMode } from \"@coderline/alphatab\";\n\nimport { Box } from '@mui/material';\n\nexport interface AlphaTabViewerHandles {\n  playPause: () => void;\n  stop: () => void;\n  setPlaybackPosition: (tick: number) => void;\n  get a_api(): AlphaTabApi | null;\n}\n\ninterface AlphaTabViewerProps {\n  xmlPath: string;\n  layoutMode?: 'page' | 'horizontal';\n  onScoreLoaded?: (score: any, duration: number) => void;\n  onMidiLoaded?: (e: { endTime: number }) => void;\n  onPlayerPositionChanged?: (e: { currentTime: number, endTime: number }) => void;\n  onPlayerStateChanged?: (e: { state: number, isPlaying: boolean }) => void;\n  width?: string | number;\n  height?: string | number;\n  scaling?: number;\n}\n\nexport const AlphaTabViewer = forwardRef<AlphaTabViewerHandles, AlphaTabViewerProps>(({ xmlPath, onScoreLoaded, onMidiLoaded, onPlayerPositionChanged, onPlayerStateChanged, width = '100%', height = '100%', scaling = 0.5, layoutMode = 'horizontal' }: AlphaTabViewerProps, ref) => {\n  const elementRef = useRef<HTMLDivElement | null>(null);\n  const apiRef = useRef<AlphaTabApi | null>(null);\n  useEffect(() => {\n    if (!elementRef.current || !xmlPath) return;\n\n    const baseUrl = window.location.origin;\n    const settings: Settings = {\n      core: {\n        fontDirectory: `${baseUrl}/alphaTab/font/`,\n      },\n      player: {\n        enablePlayer: true,\n        enableCursor: true,\n        soundFont: `${baseUrl}/alphaTab/soundfont/sonivox.sf2`\n      },\n      display: {\n        layoutMode: layoutMode,\n        width: width,        // Chiều rộng của trang hiển thị\n        height: height,       // Chiều cao trang (nếu layoutMode là 'page')\n        scaling: scaling,       // Tỉ lệ phóng to (1.0 = 100%)        \n      },\n    };\n\n    const api = new AlphaTabApi(elementRef.current!, settings);\n    apiRef.current = api;\n\n    if (onScoreLoaded) {\n      apiRef.current.scoreLoaded.on((score) => {\n        onScoreLoaded(score, 0);\n      });\n      apiRef.current.playerReady.on(() => {\n        console.log('Thời lượng phát (giây):', api.player.duration);\n      });\n    }\n    if (onPlayerPositionChanged) {\n      apiRef.current.playerPositionChanged.on(onPlayerPositionChanged);\n    }\n    if (onMidiLoaded) {\n      apiRef.current.midiLoaded.on(onMidiLoaded);\n    }\n    if (onPlayerStateChanged) {\n      apiRef.current.playerStateChanged.on(onPlayerStateChanged);\n    }\n\n    // Sử dụng prop xmlPath để load file nhạc\n    apiRef.current.load(xmlPath);\n\n    return () => {\n      if (apiRef.current) {\n        apiRef.current?.destroy();\n      }\n    };\n  }, [xmlPath, onScoreLoaded, onPlayerPositionChanged, onPlayerStateChanged, onMidiLoaded, layoutMode, width, height, scaling]);\n\n  useImperativeHandle(ref, () => ({\n    playPause: () => {\n      apiRef.current?.playPause();\n    },\n    stop: () => {\n      apiRef.current?.stop();\n    },\n    setPlaybackPosition: (tick: number) => {\n      if (apiRef.current) apiRef.current.playbackRange = null;\n      if (apiRef.current) apiRef.current.tickPosition = tick;\n    },\n    get a_api() { return apiRef.current; }\n  }));\n  return (\n\n    <Box\n      sx={{\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        backgroundColor: 'lightblue'\n      }}\n    >\n      <div ref={elementRef} style={{ width: '100%', height: '100%' }} />\n    </Box >\n  );\n});\nAlphaTabViewer.displayName = 'AlphaTabViewer';"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAEA;;;AALA;;;;AA0BO,MAAM,+BAAiB,GAAA,IAAA,2KAAU,UAA6C,CAAC,EAAE,OAAO,EAAE,aAAa,EAAE,YAAY,EAAE,uBAAuB,EAAE,oBAAoB,EAAE,QAAQ,MAAM,EAAE,SAAS,MAAM,EAAE,UAAU,GAAG,EAAE,aAAa,YAAY,EAAuB,EAAE;;IAC7Q,MAAM,aAAa,IAAA,uKAAM,EAAwB;IACjD,MAAM,SAAS,IAAA,uKAAM,EAAqB;IAC1C,IAAA,0KAAS;oCAAC;YACR,IAAI,CAAC,WAAW,OAAO,IAAI,CAAC,SAAS;YAErC,MAAM,UAAU,OAAO,QAAQ,CAAC,MAAM;YACtC,MAAM,WAAqB;gBACzB,MAAM;oBACJ,eAAe,GAAG,QAAQ,eAAe,CAAC;gBAC5C;gBACA,QAAQ;oBACN,cAAc;oBACd,cAAc;oBACd,WAAW,GAAG,QAAQ,+BAA+B,CAAC;gBACxD;gBACA,SAAS;oBACP,YAAY;oBACZ,OAAO;oBACP,QAAQ;oBACR,SAAS;gBACX;YACF;YAEA,MAAM,MAAM,IAAI,sLAAW,CAAC,WAAW,OAAO,EAAG;YACjD,OAAO,OAAO,GAAG;YAEjB,IAAI,eAAe;gBACjB,OAAO,OAAO,CAAC,WAAW,CAAC,EAAE;gDAAC,CAAC;wBAC7B,cAAc,OAAO;oBACvB;;gBACA,OAAO,OAAO,CAAC,WAAW,CAAC,EAAE;gDAAC;wBAC5B,QAAQ,GAAG,CAAC,2BAA2B,IAAI,MAAM,CAAC,QAAQ;oBAC5D;;YACF;YACA,IAAI,yBAAyB;gBAC3B,OAAO,OAAO,CAAC,qBAAqB,CAAC,EAAE,CAAC;YAC1C;YACA,IAAI,cAAc;gBAChB,OAAO,OAAO,CAAC,UAAU,CAAC,EAAE,CAAC;YAC/B;YACA,IAAI,sBAAsB;gBACxB,OAAO,OAAO,CAAC,kBAAkB,CAAC,EAAE,CAAC;YACvC;YAEA,yCAAyC;YACzC,OAAO,OAAO,CAAC,IAAI,CAAC;YAEpB;4CAAO;oBACL,IAAI,OAAO,OAAO,EAAE;wBAClB,OAAO,OAAO,EAAE;oBAClB;gBACF;;QACF;mCAAG;QAAC;QAAS;QAAe;QAAyB;QAAsB;QAAc;QAAY;QAAO;QAAQ;KAAQ;IAE5H,IAAA,oLAAmB,EAAC;8CAAK,IAAM,CAAC;gBAC9B,SAAS;0DAAE;wBACT,OAAO,OAAO,EAAE;oBAClB;;gBACA,IAAI;0DAAE;wBACJ,OAAO,OAAO,EAAE;oBAClB;;gBACA,mBAAmB;0DAAE,CAAC;wBACpB,IAAI,OAAO,OAAO,EAAE,OAAO,OAAO,CAAC,aAAa,GAAG;wBACnD,IAAI,OAAO,OAAO,EAAE,OAAO,OAAO,CAAC,YAAY,GAAG;oBACpD;;gBACA,IAAI,SAAQ;oBAAE,OAAO,OAAO,OAAO;gBAAE;YACvC,CAAC;;IACD,qBAEE,6LAAC,2LAAG;QACF,IAAI;YACF,UAAU;YACV,KAAK;YACL,MAAM;YACN,OAAO;YACP,QAAQ;YACR,iBAAiB;QACnB;kBAEA,cAAA,6LAAC;YAAI,KAAK;YAAY,OAAO;gBAAE,OAAO;gBAAQ,QAAQ;YAAO;;;;;;;;;;;AAGnE;;AACA,eAAe,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///www/wwwroot/pianosync.com/src/app/components/container/PageContainer.tsx"],"sourcesContent":["import { Helmet, HelmetProvider } from 'react-helmet-async';\r\n\r\ntype Props = {\r\n  seo: {\r\n    title: string;\r\n    description: string;\r\n    keywords: string;\r\n    thumb: string;\r\n  };\r\n  children: JSX.Element | JSX.Element[];\r\n};\r\n\r\nconst PageContainer = ({ seo, children }: Props) => {\r\n  return (\r\n    <HelmetProvider>\r\n      <div>\r\n        <Helmet>\r\n          <title>{seo.title}</title>\r\n          {/* Description & Keywords */}\r\n          <meta name=\"description\" content={seo.description} />\r\n          <meta name=\"keywords\" content={seo.keywords} />\r\n\r\n          {/* Open Graph */}\r\n          <meta property=\"og:title\" content={seo.title} />\r\n          <meta property=\"og:description\" content={seo.description} />\r\n          <meta property=\"og:image\" content={seo.thumb} />\r\n          <meta property=\"og:type\" content=\"website\" />\r\n\r\n          {/* Twitter Card */}\r\n          <meta name=\"twitter:card\" content=\"summary_large_image\" />\r\n          <meta name=\"twitter:title\" content={seo.title} />\r\n          <meta name=\"twitter:description\" content={seo.description} />\r\n        </Helmet>\r\n        {children}\r\n      </div>\r\n    </HelmetProvider>\r\n  );\r\n}\r\n\r\nexport default PageContainer;\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAYA,MAAM,gBAAgB,CAAC,EAAE,GAAG,EAAE,QAAQ,EAAS;IAC7C,qBACE,6LAAC,uLAAc;kBACb,cAAA,6LAAC;;8BACC,6LAAC,+KAAM;;sCACL,6LAAC;sCAAO,IAAI,KAAK;;;;;;sCAEjB,6LAAC;4BAAK,MAAK;4BAAc,SAAS,IAAI,WAAW;;;;;;sCACjD,6LAAC;4BAAK,MAAK;4BAAW,SAAS,IAAI,QAAQ;;;;;;sCAG3C,6LAAC;4BAAK,UAAS;4BAAW,SAAS,IAAI,KAAK;;;;;;sCAC5C,6LAAC;4BAAK,UAAS;4BAAiB,SAAS,IAAI,WAAW;;;;;;sCACxD,6LAAC;4BAAK,UAAS;4BAAW,SAAS,IAAI,KAAK;;;;;;sCAC5C,6LAAC;4BAAK,UAAS;4BAAU,SAAQ;;;;;;sCAGjC,6LAAC;4BAAK,MAAK;4BAAe,SAAQ;;;;;;sCAClC,6LAAC;4BAAK,MAAK;4BAAgB,SAAS,IAAI,KAAK;;;;;;sCAC7C,6LAAC;4BAAK,MAAK;4BAAsB,SAAS,IAAI,WAAW;;;;;;;;;;;;gBAE1D;;;;;;;;;;;;AAIT;KAzBM;uCA2BS","debugId":null}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///www/wwwroot/pianosync.com/src/app/test/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useTranslation } from 'react-i18next';\nimport { useState, useCallback, useRef } from 'react';\nimport { AlphaTabViewer, AlphaTabViewerHandles } from './AlphaTabViewer';\nimport PageContainer from '@/app/components/container/PageContainer';\nimport { Box, Slider, IconButton, Typography, Stack } from '@mui/material';\nimport { PlayArrow, Pause } from '@mui/icons-material';\n\n// Hàm định dạng thời gian từ giây sang MM:SS\nconst formatTime = (seconds: number) => {\n    const floorSeconds = Math.floor(seconds);\n    const min = Math.floor(floorSeconds / 60);\n    const sec = floorSeconds % 60;\n    return `${min}:${sec < 10 ? '0' : ''}${sec}`;\n};\n\nexport default function Test() {\n    const { t } = useTranslation();\n    const [score, setScore] = useState(null);\n    const [notesJson, setNotesJson] = useState(null);\n    const alphaTabRef = useRef<AlphaTabViewerHandles>(null);\n\n    const [isPlaying, setIsPlaying] = useState(false);\n    const [currentTime, setCurrentTime] = useState(0);\n    const [duration, setDuration] = useState(0);\n\n\n    // Thay thế bằng đường dẫn thực tế đến file xml của bạn\n    const xmlPath = \"/windy_hill.musicxml\";\n\n    const handleScoreLoaded = useCallback((loadedScore: any, newDuration: number) => {\n        setScore(loadedScore);\n        try {            const _notesJson: any = {};\n            const track = loadedScore.tracks[0];\n            let _tempo = 120;\n            let _currentTime = 0;\n\n            track.staves.forEach((stave: any) => {\n                stave.bars.forEach((bar: any) => {\n                    if (loadedScore.masterBars[bar.index].tempoAutomation) {\n                        _tempo = loadedScore.masterBars[bar.index].tempoAutomation.value;\n                    }\n                    bar.voices.forEach((voice: any) => {\n                        voice.beats.forEach((beat: any) => {\n                            const _duration = ((beat.playbackDuration * (60000.0 / (_tempo * 960))) | 0) / 1000;\n                            beat.notes.forEach((note: any) => {\n                                if (typeof _notesJson[note.displayValue] === \"undefined\") {\n                                    _notesJson[note.displayValue] = [];\n                                }\n                                _notesJson[note.displayValue].push({ start: _currentTime, stop: _currentTime + _duration, fret: note.fret, string: note.string });\n                            });\n                            _currentTime += _duration;\n                        });\n                    });\n                });\n            });\n            setNotesJson(_notesJson);\n            console.log(\"Notes JSON created:\", _notesJson);\n        } catch (e) {\n            console.error(\"Error processing score:\", e);\n        }\n    }, []);\n\n    const handlePlayerPositionChanged = useCallback((e: { currentTime: number, endTime: number }) => {\n        setCurrentTime(e.currentTime);\n    }, []);\n\n    const handlePlayerStateChanged = useCallback((e: { state: number, isPlaying: boolean }) => {\n        setIsPlaying(e.isPlaying);\n    }, []);\n\n    const handleMidiLoaded = useCallback((e: { endTime: number }) => {\n        setDuration(e.endTime);\n    }, []);\n\n    const handlePlayPause = () => {\n        alphaTabRef.current?.playPause();\n    };\n\n    const handleSeek = (event: Event, newValue: number | number[]) => {\n        const newTime = newValue as number;\n        alphaTabRef.current?.a_api?.player.seek(newTime);\n    };\n\n    return (\n        <PageContainer\n            seo={{\n                title: \"TEST AlphaTab Viewer\",\n                description: \"Test page for AlphaTab Viewer integration\",\n                keywords: \"AlphaTab, MusicXML, Viewer, Test\",\n                thumb: \"/images/seo/dashboard-home.png\",\n            }}\n        >\n            <Box sx={{ width: '100%', position: 'relative', paddingTop: '56.25%', overflow: 'hidden'}}>\n                <AlphaTabViewer\n                    ref={alphaTabRef}\n                    xmlPath={xmlPath}\n                    onScoreLoaded={handleScoreLoaded}\n                    onPlayerPositionChanged={handlePlayerPositionChanged}\n                    onMidiLoaded={handleMidiLoaded}\n                    onPlayerStateChanged={handlePlayerStateChanged}\n                    width='100%'\n                    height='calc(100vh - 250px)'\n                    scaling={0.75}                    \n                    layoutMode='horizontal'\n                />\n            </Box>\n            <Box sx={{ p: 2, border: '1px solid #ccc', borderRadius: '4px', mt: 2 }}>\n                <Stack direction=\"row\" spacing={2} alignItems=\"center\">\n                    <IconButton onClick={handlePlayPause}>\n                        {isPlaying ? <Pause /> : <PlayArrow />}\n                    </IconButton>\n                    <Typography variant=\"body2\">\n                        {formatTime(currentTime)}\n                    </Typography>\n                    <Slider\n                        aria-label=\"time-indicator\"\n                        size=\"small\"\n                        value={currentTime}\n                        min={0}\n                        step={1}\n                        max={duration}\n                        onChange={handleSeek}\n                        sx={{\n                            height: 4,\n                        }}\n                    />\n                    <Typography variant=\"body2\">\n                        {formatTime(duration)}\n                    </Typography>\n                </Stack>\n            </Box>\n        </PageContainer>\n    );\n}"],"names":[],"mappings":"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","debugId":null}}]
}