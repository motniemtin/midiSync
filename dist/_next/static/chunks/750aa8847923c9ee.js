(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,87740,e=>{"use strict";var t=e.i(82568),i=e.i(87900);async function a(e,t,i){let a;return Promise.race([e,new Promise((e,s)=>{a=setTimeout(()=>s(i),t)})]).finally(()=>clearTimeout(a))}class s extends t.WebPlugin{constructor(){super(...arguments),this.deviceMap=new Map,this.discoveredDevices=new Map,this.scan=null,this.DEFAULT_CONNECTION_TIMEOUT=1e4,this.onAdvertisementReceivedCallback=this.onAdvertisementReceived.bind(this),this.onDisconnectedCallback=this.onDisconnected.bind(this),this.onCharacteristicValueChangedCallback=this.onCharacteristicValueChanged.bind(this)}async initialize(){if("undefined"==typeof navigator||!navigator.bluetooth)throw this.unavailable("Web Bluetooth API not available in this browser.");if(!await navigator.bluetooth.getAvailability())throw this.unavailable("No Bluetooth radio available.")}async isEnabled(){return{value:!0}}async requestEnable(){throw this.unavailable("requestEnable is not available on web.")}async enable(){throw this.unavailable("enable is not available on web.")}async disable(){throw this.unavailable("disable is not available on web.")}async startEnabledNotifications(){}async stopEnabledNotifications(){}async isLocationEnabled(){throw this.unavailable("isLocationEnabled is not available on web.")}async openLocationSettings(){throw this.unavailable("openLocationSettings is not available on web.")}async openBluetoothSettings(){throw this.unavailable("openBluetoothSettings is not available on web.")}async openAppSettings(){throw this.unavailable("openAppSettings is not available on web.")}async setDisplayStrings(){}async requestDevice(e){let t=this.getFilters(e),i=await navigator.bluetooth.requestDevice({filters:t.length?t:void 0,optionalServices:null==e?void 0:e.optionalServices,acceptAllDevices:0===t.length});return this.deviceMap.set(i.id,i),this.getBleDevice(i)}async requestLEScan(e){this.requestBleDeviceOptions=e;let t=this.getFilters(e);await this.stopLEScan(),this.discoveredDevices=new Map,navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),this.scan=await navigator.bluetooth.requestLEScan({filters:t.length?t:void 0,acceptAllAdvertisements:0===t.length,keepRepeatedDevices:null==e?void 0:e.allowDuplicates})}onAdvertisementReceived(e){var t,a;let s=e.device.id;if(this.deviceMap.set(s,e.device),!this.discoveredDevices.has(s)||(null==(t=this.requestBleDeviceOptions)?void 0:t.allowDuplicates)){this.discoveredDevices.set(s,!0);let t=this.getBleDevice(e.device),n={device:t,localName:t.name,rssi:e.rssi,txPower:e.txPower,manufacturerData:(0,i.mapToObject)(e.manufacturerData),serviceData:(0,i.mapToObject)(e.serviceData),uuids:null==(a=e.uuids)?void 0:a.map(i.webUUIDToString)};this.notifyListeners("onScanResult",n)}}async stopLEScan(){var e;(null==(e=this.scan)?void 0:e.active)&&this.scan.stop(),this.scan=null}async getDevices(e){return{devices:(await navigator.bluetooth.getDevices()).filter(t=>e.deviceIds.includes(t.id)).map(e=>(this.deviceMap.set(e.id,e),this.getBleDevice(e)))}}async getConnectedDevices(e){return{devices:(await navigator.bluetooth.getDevices()).filter(e=>{var t;return null==(t=e.gatt)?void 0:t.connected}).map(e=>(this.deviceMap.set(e.id,e),this.getBleDevice(e)))}}async getBondedDevices(){return{}}async connect(e){var t,i;let s=this.getDeviceFromMap(e.deviceId);s.removeEventListener("gattserverdisconnected",this.onDisconnectedCallback),s.addEventListener("gattserverdisconnected",this.onDisconnectedCallback);let n=Symbol();if(void 0===s.gatt)throw Error("No gatt server available.");try{let i=null!=(t=e.timeout)?t:this.DEFAULT_CONNECTION_TIMEOUT;await a(s.gatt.connect(),i,n)}catch(e){if(await (null==(i=s.gatt)?void 0:i.disconnect()),e===n)throw Error("Connection timeout");throw e}}onDisconnected(e){let t=e.target.id,i=`disconnected|${t}`;this.notifyListeners(i,null)}async createBond(e){throw this.unavailable("createBond is not available on web.")}async isBonded(e){throw this.unavailable("isBonded is not available on web.")}async disconnect(e){var t;null==(t=this.getDeviceFromMap(e.deviceId).gatt)||t.disconnect()}async getServices(e){var t,i;let a=null!=(i=await (null==(t=this.getDeviceFromMap(e.deviceId).gatt)?void 0:t.getPrimaryServices()))?i:[],s=[];for(let e of a){let t=await e.getCharacteristics(),i=[];for(let e of t)i.push({uuid:e.uuid,properties:this.getProperties(e),descriptors:await this.getDescriptors(e)});s.push({uuid:e.uuid,characteristics:i})}return{services:s}}async getDescriptors(e){try{return(await e.getDescriptors()).map(e=>({uuid:e.uuid}))}catch(e){return[]}}getProperties(e){return{broadcast:e.properties.broadcast,read:e.properties.read,writeWithoutResponse:e.properties.writeWithoutResponse,write:e.properties.write,notify:e.properties.notify,indicate:e.properties.indicate,authenticatedSignedWrites:e.properties.authenticatedSignedWrites,reliableWrite:e.properties.reliableWrite,writableAuxiliaries:e.properties.writableAuxiliaries}}async getCharacteristic(e){var t;let i=await (null==(t=this.getDeviceFromMap(e.deviceId).gatt)?void 0:t.getPrimaryService(null==e?void 0:e.service));return null==i?void 0:i.getCharacteristic(null==e?void 0:e.characteristic)}async getDescriptor(e){let t=await this.getCharacteristic(e);return null==t?void 0:t.getDescriptor(null==e?void 0:e.descriptor)}async discoverServices(e){throw this.unavailable("discoverServices is not available on web.")}async getMtu(e){throw this.unavailable("getMtu is not available on web.")}async requestConnectionPriority(e){throw this.unavailable("requestConnectionPriority is not available on web.")}async readRssi(e){throw this.unavailable("readRssi is not available on web.")}async read(e){let t=await this.getCharacteristic(e);return{value:await (null==t?void 0:t.readValue())}}async write(e){let t,a=await this.getCharacteristic(e);t="string"==typeof e.value?(0,i.hexStringToDataView)(e.value):e.value,await (null==a?void 0:a.writeValueWithResponse(t))}async writeWithoutResponse(e){let t,a=await this.getCharacteristic(e);t="string"==typeof e.value?(0,i.hexStringToDataView)(e.value):e.value,await (null==a?void 0:a.writeValueWithoutResponse(t))}async readDescriptor(e){let t=await this.getDescriptor(e);return{value:await (null==t?void 0:t.readValue())}}async writeDescriptor(e){let t,a=await this.getDescriptor(e);t="string"==typeof e.value?(0,i.hexStringToDataView)(e.value):e.value,await (null==a?void 0:a.writeValue(t))}async startNotifications(e){let t=await this.getCharacteristic(e);null==t||t.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),null==t||t.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),await (null==t?void 0:t.startNotifications())}onCharacteristicValueChanged(e){var t,i;let a=e.target,s=`notification|${null==(t=a.service)?void 0:t.device.id}|${null==(i=a.service)?void 0:i.uuid}|${a.uuid}`;this.notifyListeners(s,{value:a.value})}async stopNotifications(e){let t=await this.getCharacteristic(e);await (null==t?void 0:t.stopNotifications())}getFilters(e){var t,i;let a=[];for(let i of null!=(t=null==e?void 0:e.services)?t:[])a.push({services:[i],name:null==e?void 0:e.name,namePrefix:null==e?void 0:e.namePrefix});for(let t of(((null==e?void 0:e.name)||(null==e?void 0:e.namePrefix))&&0===a.length&&a.push({name:e.name,namePrefix:e.namePrefix}),null!=(i=null==e?void 0:e.manufacturerData)?i:[]))a.push({manufacturerData:[t]});return a}getDeviceFromMap(e){let t=this.deviceMap.get(e);if(void 0===t)throw Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.');return t}getBleDevice(e){var t;return{deviceId:e.id,name:null!=(t=e.name)?t:void 0}}}e.s(["BluetoothLeWeb",()=>s],87740)}]);