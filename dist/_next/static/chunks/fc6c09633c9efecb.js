(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,57039,e=>{"use strict";var o=e.i(82568),t=o;class i extends t.WebPlugin{constructor(){super()}parseJwt(e){return JSON.parse(decodeURIComponent(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("")))}async loadScript(e){return new Promise((o,t)=>{let i=document.createElement("script");i.src=e,i.async=!0,i.onload=()=>{o()},i.onerror=t,document.body.appendChild(i)})}}i.OAUTH_STATE_KEY="social_login_oauth_pending";class r extends i{constructor(){super(...arguments),this.clientId=null,this.redirectUrl=null,this.scriptLoaded=!1,this.scriptUrl="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",this.useProperTokenExchange=!1}async initialize(e,o,t=!1){this.clientId=e,this.redirectUrl=o||null,this.useProperTokenExchange=t,e&&await this.loadAppleScript()}async login(e){if(!this.clientId)throw Error("Apple Client ID not set. Call initialize() first.");if(!this.scriptLoaded)throw Error("Apple Sign-In script not loaded.");return new Promise((o,t)=>{var i;AppleID.auth.init({clientId:this.clientId,scope:(null==(i=e.scopes)?void 0:i.join(" "))||"name email",redirectURI:this.redirectUrl||window.location.href,state:e.state,nonce:e.nonce,usePopup:!0}),AppleID.auth.signIn().then(e=>{var t,i,r,n,s;let l=null;l=this.useProperTokenExchange?null:{token:e.authorization.code||""},o({provider:"apple",result:Object.assign({profile:{user:e.user||"",email:(null==(t=e.user)?void 0:t.email)||null,givenName:(null==(r=null==(i=e.user)?void 0:i.name)?void 0:r.firstName)||null,familyName:(null==(s=null==(n=e.user)?void 0:n.name)?void 0:s.lastName)||null},accessToken:l,idToken:e.authorization.id_token||null},this.useProperTokenExchange&&{authorizationCode:e.authorization.code})})}).catch(e=>{t(e)})})}async logout(){console.log("Apple logout: Session should be managed on the client side")}async isLoggedIn(){return console.log("Apple login status should be managed on the client side"),{isLoggedIn:!1}}async getAuthorizationCode(){throw console.log("Apple authorization code should be stored during login"),Error("Apple authorization code not available")}async refresh(){console.log("Apple refresh not available on web")}async loadAppleScript(){if(!this.scriptLoaded)return this.loadScript(this.scriptUrl).then(()=>{this.scriptLoaded=!0})}}class n extends i{constructor(){super(...arguments),this.appId=null,this.scriptLoaded=!1,this.locale="en_US"}async initialize(e,o){this.appId=e,o&&(this.locale=o),e&&(await this.loadFacebookScript(this.locale),FB.init({appId:this.appId,version:"v17.0",xfbml:!0,cookie:!0}))}async login(e){if(!this.appId)throw Error("Facebook App ID not set. Call initialize() first.");return new Promise((o,t)=>{FB.login(e=>{"connected"===e.status?FB.api("/me",{fields:"id,name,email,picture"},t=>{var i,r;o({provider:"facebook",result:{accessToken:{token:e.authResponse.accessToken,userId:e.authResponse.userID},profile:{userID:t.id,name:t.name,email:t.email||null,imageURL:(null==(r=null==(i=t.picture)?void 0:i.data)?void 0:r.url)||null,friendIDs:[],birthday:null,ageRange:null,gender:null,location:null,hometown:null,profileURL:null},idToken:null}})}):t(Error("Facebook login failed"))},{scope:e.permissions.join(",")})})}async logout(){return new Promise(e=>{FB.logout(()=>e())})}async isLoggedIn(){return new Promise(e=>{FB.getLoginStatus(o=>{e({isLoggedIn:"connected"===o.status})})})}async getAuthorizationCode(){return new Promise((e,o)=>{FB.getLoginStatus(t=>{var i;"connected"===t.status?e({jwt:(null==(i=t.authResponse)?void 0:i.accessToken)||""}):o(Error("No Facebook authorization code available"))})})}async refresh(e){await this.login(e)}async loadFacebookScript(e){if(this.scriptLoaded)return;let o=document.querySelector('script[src*="connect.facebook.net"]');return o&&o.remove(),this.loadScript(`https://connect.facebook.net/${e}/sdk.js`).then(()=>{this.scriptLoaded=!0})}}class s extends i{constructor(){super(...arguments),this.clientId=null,this.loginType="online",this.GOOGLE_TOKEN_REQUEST_URL="https://www.googleapis.com/oauth2/v3/tokeninfo",this.GOOGLE_STATE_KEY="capgo_social_login_google_state"}async initialize(e,o,t,i){this.clientId=e,o&&(this.loginType=o),this.hostedDomain=t,this.redirectUrl=i}async login(e){if(!this.clientId)throw Error("Google Client ID not set. Call initialize() first.");let o=e.scopes||[];o.length>0?(o.includes("https://www.googleapis.com/auth/userinfo.email")||o.push("https://www.googleapis.com/auth/userinfo.email"),o.includes("https://www.googleapis.com/auth/userinfo.profile")||o.push("https://www.googleapis.com/auth/userinfo.profile"),o.includes("openid")||o.push("openid")):o=["https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile","openid"];let t=e.nonce||Math.random().toString(36).substring(2);return this.traditionalOAuth({scopes:o,nonce:t,hostedDomain:this.hostedDomain,prompt:e.prompt})}async logout(){if("offline"===this.loginType)return Promise.reject("Offline login doesn't store tokens. logout is not available");let e=this.getGoogleState();e&&await this.rawLogoutGoogle(e.accessToken)}async isLoggedIn(){if("offline"===this.loginType)return Promise.reject("Offline login doesn't store tokens. isLoggedIn is not available");let e=this.getGoogleState();if(!e)return{isLoggedIn:!1};try{let o=await this.accessTokenIsValid(e.accessToken),t=this.idTokenValid(e.idToken);if(o&&t)return{isLoggedIn:!0};try{await this.rawLogoutGoogle(e.accessToken,!1)}catch(e){console.error("Access token is not valid, but cannot logout",e)}return{isLoggedIn:!1}}catch(e){return Promise.reject(e)}}async getAuthorizationCode(){if("offline"===this.loginType)return Promise.reject("Offline login doesn't store tokens. getAuthorizationCode is not available");let e=this.getGoogleState();if(!e)throw Error("No Google authorization code available");try{let o=await this.accessTokenIsValid(e.accessToken),t=this.idTokenValid(e.idToken);if(o&&t)return{accessToken:e.accessToken,jwt:e.idToken};try{await this.rawLogoutGoogle(e.accessToken,!1)}catch(e){console.error("Access token is not valid, but cannot logout",e)}throw Error("No Google authorization code available")}catch(e){return Promise.reject(e)}}async refresh(){return Promise.reject("Not implemented")}handleOAuthRedirect(e){let o=e.searchParams,t=o.get("code");if(t&&o.has("scope"))return{provider:"google",result:{serverAuthCode:t,responseType:"offline"}};let r=e.hash.substring(1);if(console.log("handleOAuthRedirect",e.hash),!r)return null;console.log("handleOAuthRedirect ok");let n=new URLSearchParams(r),s=n.get("access_token"),l=n.get("id_token");if(s&&l){localStorage.removeItem(i.OAUTH_STATE_KEY);let e=this.parseJwt(l);return{provider:"google",result:{accessToken:{token:s},idToken:l,profile:{email:e.email||null,familyName:e.family_name||null,givenName:e.given_name||null,id:e.sub||null,name:e.name||null,imageUrl:e.picture||null},responseType:"online"}}}return null}async accessTokenIsValid(e){let o=`${this.GOOGLE_TOKEN_REQUEST_URL}?access_token=${encodeURIComponent(e)}`;try{let e,t,i=await fetch(o);if(!i.ok)return console.log(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. Response not successful. Status code: ${i.status}. Assuming that the token is not valid`),!1;let r=await i.text();if(!r)throw console.error(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. Response body is null`),Error(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. Response body is null`);try{e=JSON.parse(r)}catch(e){throw console.error(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. Response body is not valid JSON. Error: ${e}`),Error(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. Response body is not valid JSON. Error: ${e}`)}let n=e.expires_in;if(null==n)throw console.error(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. Response JSON does not include 'expires_in'.`),Error(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. Response JSON does not include 'expires_in'.`);try{if(t=parseInt(n,10),isNaN(t))throw Error("'expires_in' is not a valid integer")}catch(e){throw console.error(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. 'expires_in': ${n} is not a valid integer. Error: ${e}`),Error(`Invalid response from ${this.GOOGLE_TOKEN_REQUEST_URL}. 'expires_in': ${n} is not a valid integer. Error: ${e}`)}return t>5}catch(e){throw console.error(e),e}}idTokenValid(e){try{let o=this.parseJwt(e),t=Math.ceil(Date.now()/1e3)+5;return o.exp&&t<o.exp}catch(e){return!1}}async rawLogoutGoogle(e,o=null){if(null===o&&(o=await this.accessTokenIsValid(e)),!0!==o)return void this.clearStateGoogle();try{await fetch(`https://accounts.google.com/o/oauth2/revoke?token=${encodeURIComponent(e)}`),this.clearStateGoogle()}catch(e){}}persistStateGoogle(e,o){try{window.localStorage.setItem(this.GOOGLE_STATE_KEY,JSON.stringify({accessToken:e,idToken:o}))}catch(e){console.error("Cannot persist state google",e)}}clearStateGoogle(){try{window.localStorage.removeItem(this.GOOGLE_STATE_KEY)}catch(e){console.error("Cannot clear state google",e)}}getGoogleState(){try{let e=window.localStorage.getItem(this.GOOGLE_STATE_KEY);if(!e)return null;let{accessToken:o,idToken:t}=JSON.parse(e);return{accessToken:o,idToken:t}}catch(e){return console.error("Cannot get state google",e),null}}async traditionalOAuth({scopes:e,hostedDomain:o,nonce:t,prompt:r}){let n,s,l=[...new Set([...e||[],"openid"])],a=new URLSearchParams(Object.assign(Object.assign({client_id:this.clientId,redirect_uri:this.redirectUrl||window.location.origin+window.location.pathname,response_type:"offline"===this.loginType?"code":"token id_token",scope:l.join(" ")},t&&{nonce:t}),{include_granted_scopes:"true",state:"popup"}));void 0!==o&&a.append("hd",o),void 0!==r&&a.append("prompt",r);let c=`https://accounts.google.com/o/oauth2/v2/auth?${a.toString()}`,d=window.screenX+(window.outerWidth-500)/2,p=window.screenY+(window.outerHeight-600)/2;localStorage.setItem(i.OAUTH_STATE_KEY,"true");let u=window.open(c,"Google Sign In",`width=500,height=600,left=${d},top=${p},popup=1`);return new Promise((e,o)=>{if(!u)return void o(Error("Failed to open popup"));let t=o=>{var i,r,s;if(!(o.origin!==window.location.origin||(null==(r=null==(i=o.data)?void 0:i.source)?void 0:r.startsWith("angular")))&&(null==(s=o.data)?void 0:s.type)==="oauth-response")if(window.removeEventListener("message",t),clearInterval(n),"online"===this.loginType){let{accessToken:t,idToken:i}=o.data;if(t&&i){let o=this.parseJwt(i);this.persistStateGoogle(t.token,i),e({provider:"google",result:{accessToken:{token:t.token},idToken:i,profile:{email:o.email||null,familyName:o.family_name||null,givenName:o.given_name||null,id:o.sub||null,name:o.name||null,imageUrl:o.picture||null},responseType:"online"}})}}else{let{serverAuthCode:t}=o.data;e({provider:"google",result:{responseType:"offline",serverAuthCode:t}})}};window.addEventListener("message",t),s=setTimeout(()=>{clearTimeout(s),window.removeEventListener("message",t),u.close(),o(Error("OAuth timeout"))},3e5),n=setInterval(()=>{u.closed&&(clearInterval(n),o(Error("Popup closed")))},1e3)})}}class l extends o.WebPlugin{constructor(){var e;if(super(),this.googleProvider=new s,this.appleProvider=new r,this.facebookProvider=new n,localStorage.getItem(l.OAUTH_STATE_KEY)){console.log("OAUTH_STATE_KEY found");const o=this.handleOAuthRedirect();o&&(null==(e=window.opener)||e.postMessage(Object.assign({type:"oauth-response"},o.result),window.location.origin),window.close())}}handleOAuthRedirect(){let e=new URL(window.location.href);return this.googleProvider.handleOAuthRedirect(e)}async initialize(e){var o,t,i;let r=[];(null==(o=e.google)?void 0:o.webClientId)&&r.push(this.googleProvider.initialize(e.google.webClientId,e.google.mode,e.google.hostedDomain,e.google.redirectUrl)),(null==(t=e.apple)?void 0:t.clientId)&&r.push(this.appleProvider.initialize(e.apple.clientId,e.apple.redirectUrl,e.apple.useProperTokenExchange)),(null==(i=e.facebook)?void 0:i.appId)&&r.push(this.facebookProvider.initialize(e.facebook.appId,e.facebook.locale)),await Promise.all(r)}async login(e){switch(e.provider){case"google":return this.googleProvider.login(e.options);case"apple":return this.appleProvider.login(e.options);case"facebook":return this.facebookProvider.login(e.options);default:throw Error(`Login for ${e.provider} is not implemented on web`)}}async logout(e){switch(e.provider){case"google":return this.googleProvider.logout();case"apple":return this.appleProvider.logout();case"facebook":return this.facebookProvider.logout();default:throw Error(`Logout for ${e.provider} is not implemented`)}}async isLoggedIn(e){switch(e.provider){case"google":return this.googleProvider.isLoggedIn();case"apple":return this.appleProvider.isLoggedIn();case"facebook":return this.facebookProvider.isLoggedIn();default:throw Error(`isLoggedIn for ${e.provider} is not implemented`)}}async getAuthorizationCode(e){switch(e.provider){case"google":return this.googleProvider.getAuthorizationCode();case"apple":return this.appleProvider.getAuthorizationCode();case"facebook":return this.facebookProvider.getAuthorizationCode();default:throw Error(`getAuthorizationCode for ${e.provider} is not implemented`)}}async refresh(e){switch(e.provider){case"google":return this.googleProvider.refresh();case"apple":return this.appleProvider.refresh();case"facebook":return this.facebookProvider.refresh(e.options);default:throw Error(`Refresh for ${e.provider} is not implemented`)}}async providerSpecificCall(e){throw Error(`Provider specific call for ${e.call} is not implemented`)}async getPluginVersion(){return{version:"web"}}}l.OAUTH_STATE_KEY="social_login_oauth_pending",e.s(["SocialLoginWeb",()=>l],57039)}]);